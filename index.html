<!html>
<head>

	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SocketChat</title>
	<link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.0/css/bulma.css" />
</head>


<body class='container'>
	<div class='section'>
		<div class="columns is-three-quarter-tablet">
		  <div id='dataout' class="column">
			<span class='title is-3'>Chat</span> | <span id="connection-status">Offline</span> | <span id="user-count"></span>				
					<ul id='chat' class='box' style='min-height: 62vh; max-height: 80vh; overflow-y: auto; color:white; background: teal;'>
					</ul>			
		  </div>
			 <div id='dataout' class="column is-one-quarter-tablet is-hidden-mobile">
			<span class='title is-3'>Users</span>			
					<ul id='clientList' class='box is-info' style='min-height: 62vh; max-height: 80vh; overflow-y: auto; color:white; background: orange;'>
					</ul>	
		  </div>
		</div>
		<div>
			<form onsubmit='javascript:sendChatMessageToServer()' action="javascript:void(0);">
				<div class="field has-addons">
					<p class="control is-expanded">
						<input class="input" type="text" placeholder="Message">
					</p>
					<p class="control">
						<input type="submit" class="button is-primary" />
					</p>			
					</div>
			</form>
		</div>
	</div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js"></script>
<script>
  var socket = io('http://localhost:3131');	

var clientList = $('#clientList');
var chat = $('#chat');
var connectionStatus = $('#connection-status');
var userCount = $('#user-count');
	sendUserNameToServer();
	socket.emit('initialize', {});
	
  socket.on('updateClientList', function (data) {
		console.log('Clientlist: ', data);
		clientList.html('');
		userCount.html('Users: ' + data.clientIdList.length);
		data.clientIdList.forEach( function (client) {
			clientList.append('<li>'+client+'</li>')
		});
  });

	socket.on('connect', function () {
		connectionStatus.html('Online')
	});
	socket.on('disconnect', function () {
		connectionStatus.html('Offline')
	});

	 socket.on('updateClientChat', function (data) {
		 	chat.html('');
			data.clientChat.forEach( function (message) {
				chat.append('<li>'+message+'</li>');
			});
			var x = document.getElementById('chat');
			x.scrollTop = x.scrollHeight;
  });

	function sendUserNameToServer () {
		
		var username = localStorage.getItem('username') || prompt("Please enter your name:", "");
		if(username == null || username == "") {
			username = 'Generic User';
		}
		socket.emit('setUsername', { username: username});
		localStorage.setItem('username', username);
	}
  
  function sendChatMessageToServer () {
		var input = $('input:text').val();
		socket.emit('datain', { 'input' : input});
		$('input:text').val('');
  }
</script>

</html>